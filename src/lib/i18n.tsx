import { createContext, useContext, useState, ReactNode, useCallback } from 'react'

export type Locale = 'fr' | 'en'

const translations = {
    en: {
        // General
        appName: 'ROBY',
        loading: 'Loading...',
        save: 'Save',
        cancel: 'Cancel',
        delete: 'Delete',
        edit: 'Edit',
        add: 'Add',
        close: 'Close',
        search: 'Search',
        filter: 'Filter...',
        noResults: 'No results.',
        confirm: 'Confirm',
        actions: 'Actions',
        page: 'Page',
        of: 'of',
        previous: 'Previous',
        next: 'Next',
        yes: 'Yes',
        no: 'No',
        refresh: 'Refresh',
        status: 'Status',
        total: 'Total',
        id: 'ID',

        // Auth
        signIn: 'Sign In',
        signInTitle: 'Welcome back',
        signInSubtitle: 'Sign in to your account',
        email: 'Email address',
        password: 'Password',
        signingIn: 'Signing in...',
        signOut: 'Sign out',
        yourProfile: 'Your profile',
        noTenantTitle: 'No Workspace Selected',
        noTenantMsg: 'Please contact your administrator.',
        backToLogin: 'Back to Login',

        // Navigation
        articles: 'Articles',
        stock: 'Stock',
        services: 'Services',
        expenses: 'Expenses',
        workers: 'Workers',
        tenants: 'Tenants',

        // Tenant Management
        createTenant: 'Create Tenant',
        tenantName: 'Tenant Name',
        tenantSlug: 'Slug',
        tenantLogo: 'Tenant Logo',
        uploadLogo: 'Upload Logo',
        updateLogo: 'Update Logo',
        removeLogo: 'Remove Logo',
        logoUpdated: 'Logo updated successfully',
        invalidLogoFile: 'Please select a valid image file.',
        logoFileTooLarge: 'Logo file is too large (max 2MB).',
        creating: 'Creating...',
        createdAt: 'Created At',
        switchTo: 'Switch To',
        members: 'Members',
        manageTenantMembers: 'Members',
        addMember: 'Add Member',
        createMemberWithCreds: 'Create User + Credentials',
        createUserAndAssign: 'Create & Assign',
        createMemberHint: 'Creates a new login user and immediately assigns them to this tenant.',
        memberNameOrId: 'User name or UUID',
        memberHint: 'Enter the user\'s full name or their UUID. They must have signed up first.',
        role: 'Role',
        admin: 'Admin',
        user: 'User',
        adding: 'Adding...',
        removeMember: 'Remove member',
        unnamedUser: 'Unnamed User',
        noMembers: 'No members yet',
        loadingMembers: 'Loading members...',
        confirmRemoveSelf: 'Are you sure you want to remove yourself from this tenant?',
        userAlreadyMember: 'This user is already a member of this tenant',
        noUserFound: 'No user found. Try entering the exact user ID (UUID).',
        multipleUsersFound: 'Multiple users found. Please use the exact user ID:',

        // Articles
        articleManagement: 'Article Management',
        familles: 'Families',
        categories: 'Categories',
        newArticle: 'New Article',
        editArticle: 'Edit Article',
        articleName: 'Name',
        articlePhoto: 'Article Photo',
        uploadPhoto: 'Upload Photo',
        removePhoto: 'Remove Photo',
        newFamille: 'New Family',
        familleName: 'Family Name',
        newCategory: 'New Category',
        categoryName: 'Category Name',
        selectFamille: 'Select Family',
        selectCategory: 'Select Category',
        initialQty: 'Initial Quantity',
        purchasePrice: 'Purchase Price',
        retailPrice: 'Retail Price',
        wholesalePrice: 'Wholesale Price',
        locationPriceMin: 'Location Price Min',
        locationPriceMax: 'Location Price Max',
        locationPriceRangeError: 'Location price must be between min and max for this article.',
        adjustStock: 'Adjust Stock',
        qtyDelta: 'Quantity Delta (+/-)',
        reason: 'Reason',
        adjustment: 'Adjustment',
        note: 'Note',
        stockQty: 'Stock',
        allFamilles: 'All Families',
        allCategories: 'All Categories',
        correction: 'Correction',
        damage: 'Damage',
        other: 'Other',
        saving: 'Saving...',
        editService: 'Edit Service',

        // Clients
        createNewClient: 'Create New Client',
        fullName: 'Full Name',
        phone: 'Phone',
        client: 'Client',
        rentalStart: 'Rental Start',
        rentalEnd: 'Rental End',
        qty: 'Qty',
        newClient: 'New Client',
        editClient: 'Edit Client',
        age: 'Age',
        address: 'Address',
        confirmDelete: 'Are you sure you want to delete this item?',
        personalInfo: 'Personal Information',
        clientDetails: 'Client Details',
        clientHistory: 'Client History',
        noClientHistory: 'No service history for this client yet.',

        // Stock
        stockOverview: 'Stock Overview',
        stockHistory: 'Stock History',
        article: 'Article',
        famille: 'Family',
        category: 'Category',
        color: 'Color',
        buyPrice: 'Buy Price',
        history: 'History',
        noMovements: 'No movements recorded.',

        // Expenses
        expensesTitle: 'Expenses',
        newExpense: 'New Expense',
        type: 'Type',
        label: 'Label',
        amount: 'Amount',
        date: 'Date',
        description: 'Description',
        interne: 'Internal',
        voyage: 'Travel',
        retoucheArticle: 'Article Rework',
        selectArticle: 'Select Article',
        selectClient: 'Search or select a client...',

        // Workers
        workersTitle: 'Workers',
        newWorker: 'New Worker',
        editWorker: 'Edit Worker',
        workerName: 'Name',
        cin: 'CIN',
        baseSalary: 'Base Salary',
        joinDate: 'Join Date',
        payDay: 'Pay Day (day of month)',
        salaryPayments: 'Salary Payments',
        markAsPaid: 'Mark as Paid',
        paid: 'Paid',
        unpaid: 'Unpaid',
        overdue: 'Overdue',
        dueToday: 'Due Today',
        paymentDueAlert: 'Payment Due',
        salaryHistory: 'Payment History',
        period: 'Period',
        paidOn: 'Paid On',
        notes: 'Notes',
        noPayments: 'No payments recorded.',
        paymentReminder: 'workers need to be paid',
        dayOfMonth: 'of each month',
        nextPayment: 'Next Payment',

        // Services
        servicesTitle: 'Services',
        newService: 'New Service',
        serviceDetails: 'Service Details',
        rentalPeriod: 'Rental Period',
        from: 'From',
        to: 'To',
        deposit: 'Deposit',
        serviceItems: 'Items',
        unitPrice: 'Unit Price',

        // KPI
        kpi: 'Dashboard',
        kpiTitle: 'Dashboard',
        kpiSubtitle: 'Overview of your business performance',
        totalEarnings: 'Total Earnings',
        totalExpenses: 'Total Expenses',
        netProfit: 'Net Profit',
        stockValue: 'Stock Value',
        sales: 'Sales',
        rentals: 'Rentals',
        monthlyOverview: 'Monthly Overview',
        monthlyEarnings: 'Earnings',
        monthlyExpenses: 'Expenses',
        monthlyNet: 'Net',
        monthlyPayroll: 'Monthly Payroll',
        quickStats: 'Quick Stats',
        clients: 'Clients',
        recentServices: 'Recent Services',
        lowStockAlert: 'Low Stock Alert',
        allStockGood: 'All stock levels are good!',
        inStock: 'in stock',
        periodWeek: 'Week',
        periodMonth: 'Month',
        periodQuarter: 'Quarter',
        periodYear: 'Year',
        periodAll: 'All Time',
        periodOverview: 'Period Overview',
        deleteConfirmTitle: 'Confirm Deletion',
        deleteConfirmMessage: 'Are you sure you want to permanently delete',

        // Tenant Switcher
        selectTenant: 'Select Tenant',
        noTenants: 'No Tenants Found',

        // Lang
        language: 'Language',
    },
    fr: {
        // General
        appName: 'ROBY',
        loading: 'Chargement...',
        save: 'Enregistrer',
        cancel: 'Annuler',
        delete: 'Supprimer',
        edit: 'Modifier',
        add: 'Ajouter',
        close: 'Fermer',
        search: 'Rechercher',
        filter: 'Filtrer...',
        noResults: 'Aucun résultat.',
        confirm: 'Confirmer',
        actions: 'Actions',
        page: 'Page',
        of: 'de',
        previous: 'Précédent',
        next: 'Suivant',
        yes: 'Oui',
        no: 'Non',
        refresh: 'Actualiser',
        status: 'Statut',
        total: 'Total',
        id: 'ID',

        // Auth
        signIn: 'Se connecter',
        signInTitle: 'Bon retour',
        signInSubtitle: 'Connectez-vous à votre compte',
        email: 'Adresse e-mail',
        password: 'Mot de passe',
        signingIn: 'Connexion...',
        signOut: 'Déconnexion',
        yourProfile: 'Votre profil',
        noTenantTitle: 'Aucun espace sélectionné',
        noTenantMsg: 'Veuillez contacter votre administrateur.',
        backToLogin: 'Retour à la connexion',

        // Navigation
        articles: 'Articles',
        stock: 'Stock',
        services: 'Services',
        expenses: 'Dépenses',
        workers: 'Ouvriers',
        tenants: 'Locataires',

        // Tenant Management
        createTenant: 'Créer un locataire',
        tenantName: 'Nom du locataire',
        tenantSlug: 'Slug',
        tenantLogo: 'Logo du locataire',
        uploadLogo: 'Televerser logo',
        updateLogo: 'Mettre a jour logo',
        removeLogo: 'Supprimer logo',
        logoUpdated: 'Logo mis a jour avec succes',
        invalidLogoFile: 'Veuillez choisir un fichier image valide.',
        logoFileTooLarge: 'Le fichier logo est trop volumineux (max 2Mo).',
        creating: 'Création...',
        createdAt: 'Créé le',
        switchTo: 'Basculer',
        members: 'Membres',
        manageTenantMembers: 'Membres',
        addMember: 'Ajouter un membre',
        createMemberWithCreds: 'Creer utilisateur + identifiants',
        createUserAndAssign: 'Creer et affecter',
        createMemberHint: 'Cree un nouvel utilisateur de connexion puis l\'affecte immediatement a ce locataire.',
        memberNameOrId: 'Nom ou UUID de l\'utilisateur',
        memberHint: 'Entrez le nom complet ou l\'UUID de l\'utilisateur. Il doit s\'être inscrit au préalable.',
        role: 'Rôle',
        admin: 'Admin',
        user: 'Utilisateur',
        adding: 'Ajout...',
        removeMember: 'Retirer le membre',
        unnamedUser: 'Utilisateur sans nom',
        noMembers: 'Aucun membre pour le moment',
        loadingMembers: 'Chargement des membres...',
        confirmRemoveSelf: 'Êtes-vous sûr de vouloir vous retirer de ce locataire ?',
        userAlreadyMember: 'Cet utilisateur est déjà membre de ce locataire',
        noUserFound: 'Aucun utilisateur trouvé. Essayez l\'UUID exact.',
        multipleUsersFound: 'Plusieurs utilisateurs trouvés. Utilisez l\'UUID exact :',

        // Articles
        articleManagement: 'Gestion des Articles',
        familles: 'Familles',
        categories: 'Catégories',
        newArticle: 'Nouvel Article',
        editArticle: 'Modifier l\'Article',
        articleName: 'Nom',
        articlePhoto: 'Photo article',
        uploadPhoto: 'Televerser photo',
        removePhoto: 'Supprimer photo',
        newFamille: 'Nouvelle Famille',
        familleName: 'Nom de la Famille',
        newCategory: 'Nouvelle Catégorie',
        categoryName: 'Nom de la Catégorie',
        selectFamille: 'Sélectionner une Famille',
        selectCategory: 'Sélectionner une Catégorie',
        initialQty: 'Quantité initiale',
        purchasePrice: 'Prix d\'achat',
        retailPrice: 'Prix de vente par détail',
        wholesalePrice: 'Prix de vente en gros',
        locationPriceMin: 'Prix location min',
        locationPriceMax: 'Prix location max',
        locationPriceRangeError: 'Le prix de location doit etre entre le min et le max de cet article.',
        adjustStock: 'Ajuster le Stock',
        qtyDelta: 'Delta quantité (+/-)',
        reason: 'Raison',
        adjustment: 'Ajustement',
        note: 'Note',
        stockQty: 'Stock',
        allFamilles: 'Toutes les Familles',
        allCategories: 'Toutes les Catégories',
        correction: 'Correction',
        damage: 'Dommage',
        other: 'Autre',
        saving: 'Enregistrement...',
        editService: 'Modifier le Service',

        // Clients
        createNewClient: 'Créer un Nouveau Client',
        fullName: 'Nom Complet',
        phone: 'Téléphone',
        client: 'Client',
        rentalStart: 'Début de Location',
        rentalEnd: 'Fin de Location',
        qty: 'Qté',
        newClient: 'Nouveau Client',
        editClient: 'Modifier Client',
        age: 'Âge',
        address: 'Adresse',
        confirmDelete: 'Êtes-vous sûr de vouloir supprimer cet élément ?',
        personalInfo: 'Informations Personnelles',
        clientDetails: 'Détails du Client',
        clientHistory: 'Historique Client',
        noClientHistory: 'Aucun historique de service pour ce client pour le moment.',

        // Stock
        stockOverview: 'Aperçu du Stock',
        stockHistory: 'Historique du Stock',
        article: 'Article',
        famille: 'Famille',
        category: 'Catégorie',
        color: 'Couleur',
        buyPrice: 'Prix d\'achat',
        history: 'Historique',
        noMovements: 'Aucun mouvement enregistré.',

        // Expenses
        expensesTitle: 'Dépenses',
        newExpense: 'Nouvelle Dépense',
        type: 'Type',
        label: 'Libellé',
        amount: 'Montant',
        date: 'Date',
        description: 'Description',
        interne: 'Interne',
        voyage: 'Voyage',
        retoucheArticle: 'Retouche Article',
        selectArticle: 'Sélectionner un article',
        selectClient: 'Rechercher ou sélectionner un client...',

        // Workers
        workersTitle: 'Ouvriers',
        newWorker: 'Nouvel Ouvrier',
        editWorker: 'Modifier l\'Ouvrier',
        workerName: 'Nom',
        cin: 'CIN',
        baseSalary: 'Salaire de base',
        joinDate: 'Date d\'embauche',
        payDay: 'Jour de paie (jour du mois)',
        salaryPayments: 'Paiements de salaire',
        markAsPaid: 'Marquer comme payé',
        paid: 'Payé',
        unpaid: 'Non payé',
        overdue: 'En retard',
        dueToday: 'Dû aujourd\'hui',
        paymentDueAlert: 'Paiement dû',
        salaryHistory: 'Historique des paiements',
        period: 'Période',
        paidOn: 'Payé le',
        notes: 'Notes',
        noPayments: 'Aucun paiement enregistré.',
        paymentReminder: 'ouvriers à payer',
        dayOfMonth: 'de chaque mois',
        nextPayment: 'Prochain Paiement',

        // Services
        servicesTitle: 'Services',
        newService: 'Nouveau Service',
        serviceDetails: 'Détails du Service',
        rentalPeriod: 'Période de Location',
        from: 'Du',
        to: 'Au',
        deposit: 'Caution',
        serviceItems: 'Articles',
        unitPrice: 'Prix Unitaire',

        // KPI
        kpi: 'Tableau de bord',
        kpiTitle: 'Tableau de bord',
        kpiSubtitle: 'Aperçu de la performance de votre entreprise',
        totalEarnings: 'Revenus totaux',
        totalExpenses: 'Dépenses totales',
        netProfit: 'Bénéfice net',
        stockValue: 'Valeur du stock',
        sales: 'Ventes',
        rentals: 'Locations',
        monthlyOverview: 'Aperçu mensuel',
        monthlyEarnings: 'Revenus',
        monthlyExpenses: 'Dépenses',
        monthlyNet: 'Net',
        monthlyPayroll: 'Masse salariale',
        quickStats: 'Statistiques rapides',
        clients: 'Clients',
        recentServices: 'Services récents',
        lowStockAlert: 'Alerte stock bas',
        allStockGood: 'Tous les niveaux de stock sont bons !',
        inStock: 'en stock',
        periodWeek: 'Semaine',
        periodMonth: 'Mois',
        periodQuarter: 'Trimestre',
        periodYear: 'Année',
        periodAll: 'Tout',
        periodOverview: 'Aperçu de la période',
        deleteConfirmTitle: 'Confirmer la suppression',
        deleteConfirmMessage: 'Êtes-vous sûr de vouloir supprimer définitivement',

        // Tenant Switcher
        selectTenant: 'Sélectionner un locataire',
        noTenants: 'Aucun locataire trouvé',

        // Lang
        language: 'Langue',
    }
} as const

export type TranslationKey = keyof typeof translations.en

interface I18nContextType {
    locale: Locale
    setLocale: (locale: Locale) => void
    t: (key: TranslationKey) => string
}

const I18nContext = createContext<I18nContextType | undefined>(undefined)

export function I18nProvider({ children }: { children: ReactNode }) {
    const [locale, setLocaleState] = useState<Locale>(() => {
        const saved = localStorage.getItem('roby_locale')
        return (saved === 'fr' || saved === 'en') ? saved : 'fr'
    })

    const setLocale = useCallback((newLocale: Locale) => {
        setLocaleState(newLocale)
        localStorage.setItem('roby_locale', newLocale)
    }, [])

    const t = useCallback((key: TranslationKey): string => {
        return translations[locale][key] || key
    }, [locale])

    return (
        <I18nContext.Provider value={{ locale, setLocale, t }}>
            {children}
        </I18nContext.Provider>
    )
}

export function useI18n() {
    const ctx = useContext(I18nContext)
    if (!ctx) throw new Error('useI18n must be used within I18nProvider')
    return ctx
}
